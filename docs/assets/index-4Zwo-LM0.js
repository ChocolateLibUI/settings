var C=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)};var u=(i,e,t)=>(C(i,e,"read from private field"),t?t.call(i):e.get(i)),f=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},c=(i,e,t,s)=>(C(i,e,"write to private field"),s?s.call(i,t):e.set(i,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}})();class x{constructor(e){this.value=e}get ok(){return!0}get err(){return!1}expect(){return this.value}expectErr(e){throw new Error(e)}get unwrap(){return this.value}unwrapOr(){return this.value}andThen(e){return e(this.value)}orElse(){return this}map(e){return new x(e(this.value))}mapErr(){return this}get toOptional(){return new I(this.value)}safeUnwrap(){return this.value}}var y;const V=class V{constructor(e){f(this,y,void 0);c(this,y,new Error().stack),this.error=e}get valid(){return!1}get ok(){return!1}get err(){return!0}expect(e){throw new Error(e+`
Original `+u(this,y)+`
Expect Error`)}expectErr(){return this.error}get unwrap(){throw new Error(`Tried to unwrap Error
Original `+u(this,y)+`
Unwrap Error`)}unwrapOr(e){return e}andThen(){return this}orElse(e){return e(this.error)}map(){return this}mapErr(e){return new V(e(this.error))}get toOptional(){return new U}get stack(){return u(this,y)}};y=new WeakMap;let P=V;class I{constructor(e){this.value=e}get valid(){return!0}get some(){return!0}get none(){return!1}expect(){return this.value}get unwrap(){return this.value}unwrapOr(){return this.value}andThen(e){return e(this.value)}orElse(){return this}map(e){return new I(e(this.value))}toResult(){return new x(this.value)}}class U{get valid(){return!1}get some(){return!1}get none(){return!0}expect(e){throw new Error(e)}get unwrap(){throw new Error("Tried to unwrap None")}unwrapOr(e){return e}andThen(){return this}orElse(e){return e()}map(){return this}toResult(e){return new P(e)}}function b(i){return new x(i)}function N(i){return new I(i)}function T(){return new U}class A{constructor(){this.subscribers=[]}subscribe(e,t){return this.subscribers.includes(e)?(console.warn("Function already registered as subscriber"),e):(this.onSubscribe(this.subscribers.length==0),this.subscribers.push(e),t&&this.then(s=>{e(s)}),e)}unsubscribe(e){const t=this.subscribers.indexOf(e);return t!=-1?(this.onUnsubscribe(this.subscribers.length==1),this.subscribers.splice(t,1)):console.warn("Subscriber not found with state",this,e),e}related(){return T()}onSubscribe(e){}onUnsubscribe(e){}inUse(){return!!this.subscribers.length}hasSubscriber(e){return this.subscribers.includes(e)}updateSubscribers(e){for(let t=0,s=this.subscribers.length;t<s;t++)try{this.subscribers[t](e)}catch(r){console.warn("Failed while calling subscribers ",r,this,this.subscribers[t])}}}var d,v,g;class F extends A{constructor(t,s,r){super();f(this,d,void 0);f(this,v,void 0);f(this,g,void 0);if(s&&c(this,v,s===!0?n=>{var a;return(a=u(this,g))!=null&&a.limit?u(this,g).limit(n).map(h=>b(h)):N(b(n))}:s),r&&c(this,g,r),typeof t=="function"){let n=new Promise(a=>{this.then=async h=>(c(this,d,t()),delete this.then,delete this.write,delete this.get,a(),h(u(this,d))),this.get=()=>(c(this,d,t()),delete this.then,delete this.write,delete this.get,a(),u(this,d))});this.write=a=>{n.then(()=>{delete this.write,this.write(a)})}}else c(this,d,t)}async then(t){return t(u(this,d))}get(){return u(this,d)}related(){var t;return(t=u(this,g))!=null&&t.related?u(this,g).related():T()}write(t){u(this,v)&&u(this,d).ok&&u(this,d).value!==t&&u(this,v).call(this,t).map(this.set.bind(this))}check(t){var s;return(s=u(this,g))!=null&&s.check?u(this,g).check(t):T()}limit(t){var s;return(s=u(this,g))!=null&&s.limit?u(this,g).limit(t):N(t)}set(t){c(this,d,t),this.updateSubscribers(t)}}d=new WeakMap,v=new WeakMap,g=new WeakMap;var w,E,p;class G extends A{constructor(t,s,r){super();f(this,w,void 0);f(this,E,void 0);f(this,p,void 0);if(s&&c(this,E,s===!0?n=>{var a;return(a=u(this,p))!=null&&a.limit?u(this,p).limit(n).map(h=>b(h)):N(b(n))}:s),r&&c(this,p,r),t instanceof Promise)this.then=t.then.bind(t),t.then(n=>{c(this,w,n),delete this.then,delete this.write}),this.write=n=>{t.then(()=>{delete this.write,this.write(n)})};else if(typeof t=="function"){let n=new Promise(a=>{this.then=h=>{let o=t();return this.then=o.then.bind(o),o.then(m=>{c(this,w,m),delete this.then,delete this.write,a()}),o.then(h)}});this.write=a=>{n.then(()=>{delete this.write,this.write(a)})}}else c(this,w,t)}async then(t){return t(u(this,w))}related(){var t;return(t=u(this,p))!=null&&t.related?u(this,p).related():T()}write(t){u(this,E)&&u(this,w).ok&&u(this,w).value!==t&&u(this,E).call(this,t).map(this.set.bind(this))}check(t){var s;return(s=u(this,p))!=null&&s.check?u(this,p).check(t):T()}limit(t){var s;return(s=u(this,p))!=null&&s.limit?u(this,p).limit(t):N(t)}set(t){c(this,w,t),this.updateSubscribers(t)}get(){return u(this,w)}}w=new WeakMap,E=new WeakMap,p=new WeakMap;let k,R=i=>{k=i},B=localStorage["settings/packageVersions"],O={};try{O=B?JSON.parse(B):{}}catch{}let J,q=(i,e,t,s)=>{k&&(i=k(i));let r;return O[i]!==e&&(r=O[i],O[i]=e,J&&clearTimeout(J),J=setTimeout(()=>{localStorage["settings/packageVersions"]=JSON.stringify(O)},1e3)),new L(i,t,s,r||void 0)};class K extends F{constructor(e,t,s,r,n){super(e,r,n),this.name=t,this.description=s}}class M extends G{constructor(e,t,s,r,n){super(e,r,n),this.name=t,this.description=s}}class L{constructor(e,t,s,r){this.settings={},this.subGroups={},this.versionChanged=r,this.pathID=e,this.name=t,this.description=s}makeSubGroup(e,t,s){if(e in this.subGroups){console.warn("Sub group already registered "+e);return}return this.subGroups[e]=new L(this.pathID+"/"+e,t,s,this.versionChanged)}addSetting(e,t,s,r,n,a,h){if(e in this.settings)throw new Error("Settings already registered "+e);let o=localStorage[this.pathID+"/"+e],m=this.settings[e]=new K(()=>{if(o)try{if(this.versionChanged&&h){let S=h(JSON.parse(o),this.versionChanged);return localStorage[this.pathID+"/"+e]=JSON.stringify(S),b(S)}return b(JSON.parse(o))}catch{}let l;return typeof r=="function"?l=r():l=r,localStorage[this.pathID+"/"+e]=JSON.stringify(l),b(l)},t,s,n,a);return m.subscribe(l=>{localStorage[this.pathID+"/"+e]=JSON.stringify(l.unwrap)}),m}addSettingAsync(e,t,s,r,n,a,h){if(e in this.settings)throw new Error("Settings already registered "+e);let o=localStorage[this.pathID+"/"+e],m=this.settings[e]=new M(async()=>{if(o)try{if(this.versionChanged&&h){let S=h(JSON.parse(o),this.versionChanged);return localStorage[this.pathID+"/"+e]=JSON.stringify(S),b(S)}return b(JSON.parse(o))}catch{}let l;return r instanceof Promise?l=await r:typeof r=="function"?l=await r():l=r,localStorage[this.pathID+"/"+e]=JSON.stringify(l),b(l)},t,s,n,a);return m.subscribe(l=>{localStorage[this.pathID+"/"+e]=JSON.stringify(l.unwrap)}),m}}const j="@chocolatelibui/settings",z="0.2.2";R(i=>i+"2");let D=q(j,z,"Test Settings","Description of test settings");(async()=>{let i=new G(new Promise(h=>setTimeout(h,500,1)));i.write(2),console.log(await i);let e=D.addSetting("TestBool","Test Bool","Bool Test",!1,!0),t=document.createElement("input");t.type="checkbox",document.body.appendChild(t),t.checked=(await e).unwrap,t.addEventListener("change",h=>{e.write(t.checked)});let s=D.addSetting("TestNumber"," Test Number","Number Test",()=>99,!0,void 0,(h,o)=>{switch(o){case"0.1.1":return 100;case"0.1.5":return 50;default:return 10}}),r=document.createElement("input");r.type="number",document.body.appendChild(r),r.value=String((await s).unwrap),r.addEventListener("change",async h=>{s.write(Number(r.value)),r.value=String((await s).unwrap)});let n=D.addSettingAsync("TestString","","",new Promise(h=>{setTimeout(()=>{h("yo")},5e3)}),!0),a=document.createElement("input");document.body.appendChild(a),a.value=(await n).unwrap,a.addEventListener("change",async h=>{n.write(a.value),a.value=(await n).unwrap})})();
