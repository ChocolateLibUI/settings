var x=Object.defineProperty;var w=(_,i,e)=>i in _?x(_,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):_[i]=e;var h=(_,i,e)=>(w(_,typeof i!="symbol"?i+"":i,e),e);(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))t(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&t(n)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();let v=(_,i)=>{var t;let e=new TextEncoder().encode(_);return _=new TextDecoder().decode(e.slice(0,i)),((t=_.at(-1))==null?void 0:t.charCodeAt(0))===65533?_.slice(0,-1):_};class m{constructor(i){h(this,"___valueListeners",[]);h(this,"___value");h(this,"info");this.___value=i}addListener(i,e){if(this.___valueListeners.push(i),e){let t=this.get;t instanceof Promise?t.then(i):i(t)}return i}removeListener(i){let e=this.___valueListeners.indexOf(i);return e!=-1&&this.___valueListeners.splice(e,1),i}get get(){return this.___value}set set(i){this.___value!==i&&(this.___value=i,this.___update())}___update(){if(this.___valueListeners)for(let i=0,e=this.___valueListeners.length;i<e;i++)try{this.___valueListeners[i](this.___value)}catch(t){console.warn("Failed while calling value listeners ",t)}}compare(i){let e=this.get;return e instanceof Promise?e.then(t=>i!==t):i!==e}get inUse(){return this.___valueListeners.length!==0}hasListener(i){return this.___valueListeners.indexOf(i)!==-1}toJSON(){return this.___value}}class y extends m{constructor(e,t){super(e);h(this,"___limiters");h(this,"___limitersListeners",[]);this.___limiters=t}addLimiterListener(e,t){return this.___limitersListeners.push(e),t&&e(this),e}removeLimiterListener(e){let t=this.___limitersListeners.indexOf(e);return t!=-1&&this.___limitersListeners.splice(t,1),e}___updateLimiter(){if(this.___limitersListeners)for(let e=0,t=this.___limitersListeners.length;e<t;e++)try{this.___limitersListeners[e](this)}catch(s){console.warn("Failed while calling value listeners ",s)}}get limiters(){return this.___limiters}set limiters(e){e?this.___limiters=e:delete this.___limiters,this.___updateLimiter()}checkLimit(e){if(this.___limiters){for(let t=0;t<this.___limiters.length;t++)if(this.___limiters[t].func(e))return!1}return!0}checkLimitReason(e){if(this.___limiters)for(let t=0;t<this.___limiters.length;t++){let s=this.___limiters[t];if(s.func(e))if(s.correction)switch(typeof s.reason){case"string":return{allowed:!1,reason:s.reason,correction:s.correction(e)};case"function":return{allowed:!1,reason:s.reason(e),correction:s.correction(e)}}else switch(typeof s.reason){case"string":return{allowed:!1,reason:s.reason};case"function":return{allowed:!1,reason:s.reason(e)}}}return{allowed:!0,reason:""}}set set(e){e===this.___value||!this.checkLimit(e)||(this.___value=e,this.___update())}}class g extends y{constructor(e,t=-1/0,s=1/0,r,n){super(e,n);h(this,"_min");h(this,"_max");h(this,"_step");h(this,"halfStep",0);this._min=t,this._max=s,r&&(this._step=r,this.halfStep=r/2)}get min(){return this._min}set min(e){this._min=e;let t=Math.max(this._min,this.___value);this.___value!==t&&(this.___value=t,this.___update()),this.___updateLimiter()}get max(){return this._max}set max(e){this._max=e;let t=Math.min(this._max,this.___value);this.___value!==t&&(this.___value=t,this.___update()),this.___updateLimiter()}get step(){return this._step}set step(e){if(e){this._step=e,this.halfStep=e/2;let t=this.___value%this._step,s=t>this.halfStep?this.___value+(this._step-t):this.___value-t;s!==this.___value&&(this.___value=s,this.___update())}else delete this._step,this.halfStep=0;this.___updateLimiter()}set set(e){if(this._step){let t=e%this._step;e=t>this.halfStep?e+(this._step-t):e-t}e=Math.min(this._max,Math.max(this._min,e)),e!==this.___value&&this.checkLimit(e)&&(this.___value=e,this.___update())}}class f extends y{constructor(e,t,s,r,n){super(e,n);h(this,"_maxLength");h(this,"_maxByteLength");h(this,"___enums");this._maxLength=s,this._maxByteLength=r,this.___enums=t}get enums(){return this.___enums}set enums(e){if(e){if(this.___enums=e,!this.checkEnum(this.___value))for(const t in this.___enums){this.___value=t,this.___update();return}}else delete this.___enums;this.___updateLimiter()}get enum(){if(this.___enums)return this.___enums[this.___value]}checkEnum(e){return!this.___enums||e in this.___enums}get maxLength(){return this._maxLength}set maxLength(e){this._maxLength=e,this._maxLength&&this.___value.length>this._maxLength&&(this.___value=this.___value.slice(0,this._maxLength),this.___update()),this.___updateLimiter()}get maxByteLength(){return this._maxByteLength}set maxByteLength(e){if(this._maxByteLength=e,this._maxByteLength){let t=v(this.___value,this._maxByteLength);this.___value!==t&&(this.___value=t,this.___update())}this.___updateLimiter()}set set(e){this._maxLength&&e.length>this._maxLength&&(e=e.slice(0,this._maxLength)),this._maxByteLength&&(e=v(e,this._maxByteLength)),e!==this.___value&&this.checkLimit(e)&&this.checkEnum(e)&&(this.___value=e,this.___update())}}let S={},b=(_,i,e)=>(S[_]=new L(_,i,e),S[_]);class L{constructor(i,e,t){h(this,"pathID");h(this,"settings",{});h(this,"subGroups",{});h(this,"name");h(this,"description");this.pathID=i,this.name=e,this.description=t}makeSubGroup(i,e,t){if(i in this.subGroups){console.warn("Sub group already registered "+i);return}else return this.subGroups[i]=new L(this.pathID+"/"+i,e,t)}makeBooleanSetting(i,e,t,s){if(i in this.settings)throw new Error("Settings already registered "+i);let r=localStorage[this.pathID+"/"+i];if(r)var n=new m(JSON.parse(r));else if(typeof s=="boolean")var n=new m(s);else{var n=new m(!1);s.then(u=>{n.set=u})}return n.info={name:e,description:t},n.addListener(l=>{localStorage[this.pathID+"/"+i]=JSON.stringify(l)},!r),this.settings[i]=n}makeNumberSetting(i,e,t,s,r,n,l,u){if(i in this.settings)throw new Error("Settings already registered "+i);let o=localStorage[this.pathID+"/"+i];if(o)var a=new g(JSON.parse(o),r,n,l,u);else if(typeof s=="number")var a=new g(s,r,n,l,u);else{var a=new g(NaN,r,n,l,u);s.then(d=>{a.set=d})}return a.info={name:e,description:t},a.addListener(c=>{localStorage[this.pathID+"/"+i]=JSON.stringify(c)},!o),this.settings[i]=a}makeStringSetting(i,e,t,s,r,n,l,u){if(i in this.settings)throw new Error("Settings already registered "+i);let o=localStorage[this.pathID+"/"+i];if(o)var a=new f(JSON.parse(o),r,n,l,u);else if(typeof s=="string")var a=new f(s,r,n,l,u);else{var a=new f("",r,n,l,u);s.then(d=>{a.set=d})}return a.info={name:e,description:t},a.addListener(c=>{localStorage[this.pathID+"/"+i]=JSON.stringify(c)},!o),this.settings[i]=a}}const k="@chocolatelibui/settings";let p=b(k,"Test Settings","Description of test settings");(async()=>{let _=p.makeBooleanSetting("TestBool","","",!1),i=document.createElement("input");i.type="checkbox",document.body.appendChild(i),i.checked=await _.get,i.addEventListener("change",n=>{_.set=i.checked});let e=p.makeNumberSetting("TestNumber","","",10,2,99),t=document.createElement("input");t.type="number",t.min=String(e.min),t.max=String(e.max),document.body.appendChild(t),t.value=String(await e.get),t.addEventListener("change",async n=>{e.set=Number(t.value),t.value=String(await e.get)});let s=p.makeStringSetting("TestString","","","asdf",void 0,10),r=document.createElement("input");document.body.appendChild(r),r.value=await s.get,r.addEventListener("change",async n=>{s.set=r.value,r.value=await s.get})})();
