(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();class o{constructor(){this._subscribers=[]}subscribe(e,t){if(this._subscribers.push(e),t)try{this.then(e)}catch{console.warn("Failed while calling update function",this,e)}return e}unsubscribe(e){const t=this._subscribers.indexOf(e);return t!=-1?this._subscribers.splice(t,1):console.warn("Subscriber not found with state",this,e),e}inUse(){return Boolean(this._subscribers.length)}hasSubscriber(e){return this._subscribers.includes(e)}_updateSubscribers(e){for(let t=0,r=this._subscribers.length;t<r;t++)try{this._subscribers[t](e)}catch(s){console.warn("Failed while calling subscribers ",s,this,this._subscribers[t])}}}class b extends o{constructor(e,t,r,s){super(),t&&(this._setter=t===!0?this.set:t),r&&(this._check=r),s&&(this._limit=s),this._value=e}async then(e){return await e(this._value)}write(e){this._setter&&this._value!==e&&this._setter(e,this)}check(e){return this._check?this._check(e):void 0}limit(e){return this._limit?this._limit(e):e}set(e){this._value=e,this._updateSubscribers(e)}}class m extends o{constructor(e,t){super(),t&&(this._limit=t),this._value=e}async then(e){return await e(this._value)}write(e){this._value!==e&&(e=this._limit?this._limit.limit(e):e,this._value!==e&&this.set(e))}check(e){return this._limit?this._limit.check(e):void 0}limit(e){return this._limit?this._limit.limit(e):e}set(e){this._value=e,this._updateSubscribers(e)}}class g extends o{constructor(e,t){super(),t&&(this._limit=t),this._value=e}async then(e){return await e(this._value)}write(e){this._value!==e&&(e=this._limit?this._limit.limit(e):e,this._value!==e&&this.set(e))}check(e){return this._limit?this._limit.check(e):void 0}limit(e){return this._limit?this._limit.limit(e):e}set(e){this._value=e,this._updateSubscribers(e)}}let c={},p=(l,e,t)=>(c[l]=new h(l,e,t),c[l]);class h{constructor(e,t,r){this.settings={},this.subGroups={},this.pathID=e,this.name=t,this.description=r}makeSubGroup(e,t,r){if(e in this.subGroups){console.warn("Sub group already registered "+e);return}return this.subGroups[e]=new h(this.pathID+"/"+e,t,r)}addState(e,t=void 0,r,s,i){if(e in this.settings)throw new Error("Settings already registered "+e);let n=localStorage[this.pathID+"/"+e],u=this.settings[e]=new b(void 0,r,s,i);return n?u.write(JSON.parse(n)):t.then?t.then(u.write.bind(u)):u.write(t),u.subscribe(d=>{localStorage[this.pathID+"/"+e]=JSON.stringify(d)},!n),u}addNumber(e,t=void 0,r){if(e in this.settings)throw new Error("Settings already registered "+e);let s=localStorage[this.pathID+"/"+e],i=this.settings[e]=new m(void 0,r);return s?i.write(JSON.parse(s)):t.then?t.then(i.write.bind(i)):i.write(t),i.subscribe(n=>{localStorage[this.pathID+"/"+e]=JSON.stringify(n)},!s),i}addString(e,t=void 0,r){if(e in this.settings)throw new Error("Settings already registered "+e);let s=localStorage[this.pathID+"/"+e],i=this.settings[e]=new g(void 0,r);return s?i.write(JSON.parse(s)):t.then?t.then(i.write.bind(i)):i.write(t),i.subscribe(n=>{localStorage[this.pathID+"/"+e]=JSON.stringify(n)},!s),i}}const _="@chocolatelibui/settings";let a=p(_,"Test Settings","Description of test settings");(async()=>{let l=a.addState("TestBool",!1,!0),e=document.createElement("input");e.type="checkbox",document.body.appendChild(e),e.checked=await l,e.addEventListener("change",n=>{l.write(e.checked)});let t=a.addState("TestNumber",99,!0),r=document.createElement("input");r.type="number",document.body.appendChild(r),r.value=String(await t),r.addEventListener("change",async n=>{t.write(Number(r.value)),r.value=String(await t)});let s=a.addState("TestString",new Promise(n=>{setTimeout(()=>{n("yo")},5e3)}),!0),i=document.createElement("input");document.body.appendChild(i),i.value=await s,i.addEventListener("change",async n=>{s.write(i.value),i.value=await s})})();
