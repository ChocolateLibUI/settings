var A=(s,e,t)=>{if(!e.has(s))throw TypeError("Cannot "+t)};var n=(s,e,t)=>(A(s,e,"read from private field"),t?t.call(s):e.get(s)),w=(s,e,t)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,t)},o=(s,e,t,i)=>(A(s,e,"write to private field"),i?i.call(s,t):e.set(s,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const h of r)if(h.type==="childList")for(const u of h.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function t(r){const h={};return r.integrity&&(h.integrity=r.integrity),r.referrerPolicy&&(h.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?h.credentials="include":r.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function i(r){if(r.ep)return;r.ep=!0;const h=t(r);fetch(r.href,h)}})();class J{constructor(e){this.value=e}get ok(){return!0}get err(){return!1}expect(){return this.value}expectErr(e){throw new Error(e)}get unwrap(){return this.value}unwrapOr(){return this.value}andThen(e){return e(this.value)}orElse(){return this}map(e){return new J(e(this.value))}mapErr(){return this}get toOptional(){return new D(this.value)}safeUnwrap(){return this.value}}var y;const U=class U{constructor(e){w(this,y,void 0);o(this,y,new Error().stack),this.error=e}get valid(){return!1}get ok(){return!1}get err(){return!0}expect(e){throw new Error(e+`
Original `+n(this,y)+`
Expect Error`)}expectErr(){return this.error}get unwrap(){throw new Error(`Tried to unwrap Error
Original `+n(this,y)+`
Unwrap Error`)}unwrapOr(e){return e}andThen(){return this}orElse(e){return e(this.error)}map(){return this}mapErr(e){return new U(e(this.error))}get toOptional(){return new F}get stack(){return n(this,y)}};y=new WeakMap;let k=U;class D{constructor(e){this.value=e}get valid(){return!0}get some(){return!0}get none(){return!1}expect(){return this.value}get unwrap(){return this.value}unwrapOr(){return this.value}andThen(e){return e(this.value)}orElse(){return this}map(e){return new D(e(this.value))}toResult(){return new J(this.value)}}class F{get valid(){return!1}get some(){return!1}get none(){return!0}expect(e){throw new Error(e)}get unwrap(){throw new Error("Tried to unwrap None")}unwrapOr(e){return e}andThen(){return this}orElse(e){return e()}map(){return this}toResult(e){return new k(e)}}function m(s){return new J(s)}function I(s){return new D(s)}function C(){return new F}class R{constructor(){this.subscribers=[]}subscribe(e,t){return this.subscribers.includes(e)?(console.warn("Function already registered as subscriber"),e):(this.onSubscribe(this.subscribers.length==0),this.subscribers.push(e),t&&this.then(i=>{e(i)}),e)}unsubscribe(e){const t=this.subscribers.indexOf(e);return t!=-1?(this.onUnsubscribe(this.subscribers.length==1),this.subscribers.splice(t,1)):console.warn("Subscriber not found with state",this,e),e}related(){return C()}onSubscribe(e){}onUnsubscribe(e){}inUse(){return!!this.subscribers.length}hasSubscriber(e){return this.subscribers.includes(e)}updateSubscribers(e){for(let t=0,i=this.subscribers.length;t<i;t++)try{this.subscribers[t](e)}catch(r){console.warn("Failed while calling subscribers ",r,this,this.subscribers[t])}}}var c,E,b,O;class K extends R{constructor(t,i,r,h){super();w(this,c,void 0);w(this,E,void 0);w(this,b,void 0);w(this,O,void 0);if(i&&o(this,E,i===!0?u=>n(this,b)?n(this,b).limit(u).map(a=>m(a)):I(m(u)):i),r&&o(this,b,r),h&&o(this,O,h),typeof t=="function"){let u=new Promise(a=>{this.then=async g=>(o(this,c,t()),delete this.then,delete this.write,delete this.get,a(),g(n(this,c))),this.get=()=>(o(this,c,t()),delete this.then,delete this.write,delete this.get,a(),n(this,c))});this.write=a=>{u.then(()=>{delete this.write,this.write(a)})}}else o(this,c,t)}async then(t){return t(n(this,c))}get(){return n(this,c)}related(){return n(this,O)?n(this,O).call(this):C()}write(t){n(this,E)&&n(this,c).ok&&n(this,c).value!==t&&n(this,E).call(this,t).map(this.set.bind(this))}check(t){return n(this,b)?n(this,b).check(t):void 0}limit(t){return n(this,b)?n(this,b).limit(t):I(t)}set(t){o(this,c,t),this.updateSubscribers(t)}}c=new WeakMap,E=new WeakMap,b=new WeakMap,O=new WeakMap;var p,T,f,N;class q extends R{constructor(t,i,r,h){super();w(this,p,void 0);w(this,T,void 0);w(this,f,void 0);w(this,N,void 0);if(i&&o(this,T,i===!0?u=>n(this,f)?n(this,f).limit(u).map(a=>m(a)):I(m(u)):i),r&&o(this,f,r),h&&o(this,N,h),t instanceof Promise)this.then=t.then.bind(t),t.then(u=>{o(this,p,u),delete this.then,delete this.write}),this.write=u=>{t.then(()=>{delete this.write,this.write(u)})};else if(typeof t=="function"){let u=new Promise(a=>{this.then=g=>{let d=t();return this.then=d.then.bind(d),d.then(S=>{o(this,p,S),delete this.then,delete this.write,a()}),d.then(g)}});this.write=a=>{u.then(()=>{delete this.write,this.write(a)})}}else o(this,p,t)}async then(t){return t(n(this,p))}related(){return n(this,N)?n(this,N).call(this):C()}write(t){n(this,T)&&n(this,p).ok&&n(this,p).value!==t&&n(this,T).call(this,t).map(this.set.bind(this))}check(t){return n(this,f)?n(this,f).check(t):void 0}limit(t){return n(this,f)?n(this,f).limit(t):I(t)}set(t){o(this,p,t),this.updateSubscribers(t)}get(){return n(this,p)}}p=new WeakMap,T=new WeakMap,f=new WeakMap,N=new WeakMap;let V,M=s=>{V=s},G=localStorage["settings/packageVersions"],x={};try{x=G?JSON.parse(G):{}}catch{}let P,j=(s,e,t,i)=>{V&&(s=V(s));let r;return x[s]!==e&&(r=x[s],x[s]=e,P&&clearTimeout(P),P=setTimeout(()=>{localStorage["settings/packageVersions"]=JSON.stringify(x)},1e3)),new B(s,t,i,r||void 0)};class z extends K{constructor(e,t,i,r,h,u){super(e,r,h,u),this.name=t,this.description=i}}class H extends q{constructor(e,t,i,r,h,u){super(e,r,h,u),this.name=t,this.description=i}}class B{constructor(e,t,i,r){this.settings={},this.subGroups={},this.versionChanged=r,this.pathID=e,this.name=t,this.description=i}makeSubGroup(e,t,i){if(e in this.subGroups){console.warn("Sub group already registered "+e);return}return this.subGroups[e]=new B(this.pathID+"/"+e,t,i,this.versionChanged)}addSetting(e,t,i,r,h,u,a,g){if(e in this.settings)throw new Error("Settings already registered "+e);let d=localStorage[this.pathID+"/"+e],S=this.settings[e]=new z(()=>{if(d)try{if(this.versionChanged&&g){let v=g(JSON.parse(d),this.versionChanged);return localStorage[this.pathID+"/"+e]=JSON.stringify(v),m(v)}return m(JSON.parse(d))}catch{}let l;return typeof r=="function"?l=r():l=r,localStorage[this.pathID+"/"+e]=JSON.stringify(l),m(l)},t,i,h,u,a);return S.subscribe(l=>{localStorage[this.pathID+"/"+e]=JSON.stringify(l.unwrap)}),S}addSettingAsync(e,t,i,r,h,u,a,g){if(e in this.settings)throw new Error("Settings already registered "+e);let d=localStorage[this.pathID+"/"+e],S=this.settings[e]=new H(async()=>{if(d)try{if(this.versionChanged&&g){let v=g(JSON.parse(d),this.versionChanged);return localStorage[this.pathID+"/"+e]=JSON.stringify(v),m(v)}return m(JSON.parse(d))}catch{}let l;return r instanceof Promise?l=await r:typeof r=="function"?l=await r():l=r,localStorage[this.pathID+"/"+e]=JSON.stringify(l),m(l)},t,i,h,u,a);return S.subscribe(l=>{localStorage[this.pathID+"/"+e]=JSON.stringify(l.unwrap)}),S}}const Q="@chocolatelibui/settings",W="0.1.11";M(s=>s+"2");let L=j(Q,W,"Test Settings","Description of test settings");(async()=>{let s=new q(new Promise(a=>setTimeout(a,500,1)));s.write(2),console.log(await s);let e=L.addSetting("TestBool","Test Bool","Bool Test",!1,!0),t=document.createElement("input");t.type="checkbox",document.body.appendChild(t),t.checked=(await e).unwrap,t.addEventListener("change",a=>{e.write(t.checked)});let i=L.addSetting("TestNumber"," Test Number","Number Test",99,!0,void 0,void 0,(a,g)=>{switch(g){case"0.1.1":return 100;case"0.1.5":return 50;default:return 10}}),r=document.createElement("input");r.type="number",document.body.appendChild(r),r.value=String((await i).unwrap),r.addEventListener("change",async a=>{i.write(Number(r.value)),r.value=String((await i).unwrap)});let h=L.addSettingAsync("TestString","","",new Promise(a=>{setTimeout(()=>{a("yo")},5e3)}),!0),u=document.createElement("input");document.body.appendChild(u),u.value=(await h).unwrap,u.addEventListener("change",async a=>{h.write(u.value),u.value=(await h).unwrap})})();
